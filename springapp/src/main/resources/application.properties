
# Server Port (Render provides PORT env variable)
server.port=${PORT:8080}

# MySQL Connection Settings (use environment variables)
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true

# ============================================================================
# HikariCP Connection Pool - Optimized for High-Latency Cross-Region (80ms+)
# Singapore Backend -> Mumbai RDS
# ============================================================================

# Maximum pool size - higher for cross-region to handle concurrent requests
# while waiting for slow DB responses
spring.datasource.hikari.maximum-pool-size=20

# Minimum idle connections - keep more warm connections ready
# Critical for high-latency: avoids connection creation overhead
spring.datasource.hikari.minimum-idle=10

# Connection timeout - how long to wait for a connection from pool
# Higher for cross-region to account for network variability
spring.datasource.hikari.connection-timeout=30000

# Idle timeout - how long a connection can sit idle before being removed
# Longer for high-latency: creating new connections is expensive
spring.datasource.hikari.idle-timeout=300000

# Max lifetime - maximum time a connection can exist
# Set slightly lower than MySQL's wait_timeout (default 8 hours)
# Accounts for network issues in cross-region setup
spring.datasource.hikari.max-lifetime=1800000

# Keepalive time - send keepalive packets to prevent firewall/NAT timeout
# Critical for cross-region: prevents stale connections
spring.datasource.hikari.keepalive-time=60000

# Validation timeout - how long to wait for connection validation
spring.datasource.hikari.validation-timeout=5000

# Leak detection - log warning if connection is held too long
spring.datasource.hikari.leak-detection-threshold=60000

# Pool name for monitoring/logging
spring.datasource.hikari.pool-name=SpicerackHikariCP

# ============================================================================
# JPA/Hibernate Optimizations for Reduced DB Round-Trips
# ============================================================================

# Batch statements to reduce round-trips
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# Fetch size optimization
spring.jpa.properties.hibernate.jdbc.fetch_size=50

# Keep open-in-view enabled for backward compatibility with existing endpoints
# The JOIN FETCH queries handle eager loading, but this prevents edge cases
spring.jpa.open-in-view=true

# ============================================================================
# MySQL Connection Properties for Cross-Region Optimization
# ============================================================================

# Add connection properties for better cross-region performance
spring.datasource.hikari.data-source-properties.cachePrepStmts=true
spring.datasource.hikari.data-source-properties.prepStmtCacheSize=250
spring.datasource.hikari.data-source-properties.prepStmtCacheSqlLimit=2048
spring.datasource.hikari.data-source-properties.useServerPrepStmts=true
spring.datasource.hikari.data-source-properties.useLocalSessionState=true
spring.datasource.hikari.data-source-properties.rewriteBatchedStatements=true
spring.datasource.hikari.data-source-properties.cacheResultSetMetadata=true
spring.datasource.hikari.data-source-properties.cacheServerConfiguration=true
spring.datasource.hikari.data-source-properties.elideSetAutoCommits=true
spring.datasource.hikari.data-source-properties.maintainTimeStats=false

# Swagger UI
springfox.documentation.swagger-ui.enabled=true

# Logging
logging.file.name=../logs/application.log
logging.level.root=INFO
logging.level.com.example.springapp.aspect=DEBUG 
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# Frontend URL
frontend.url=${FRONTEND_URL}